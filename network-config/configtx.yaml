# Copyright 2016-2026 Milligan Partners LLC
#
# SPDX-License-Identifier: Apache-2.0
#
# ============================================================================
# Hyperledger Fabric 2.5.x ConfigTX Configuration
# Tolling.Network - National Toll Interoperability Blockchain
# ============================================================================
#
# This configuration defines:
# - 1 Orderer organization with 3 Raft consensus nodes
# - 4 Peer organizations (toll agencies/consortiums)
# - V2_5 capabilities for Fabric 2.5.x LTS
# - TLS enabled by default
#
# PRODUCTION NOTE: Update MSPDir paths and addresses for your deployment.
# ============================================================================

---
################################################################################
#
#   Section: Organizations
#
#   This section defines the organizational identities for the network.
#   Each organization has an MSP (Membership Service Provider) that defines
#   its identity and policies.
#
################################################################################
Organizations:

    # ---------------------------------------------------------------------------
    # Orderer Organization
    # ---------------------------------------------------------------------------
    # Manages the ordering service (Raft consensus with 3 nodes).
    # In production, orderer nodes may be distributed across organizations.
    # ---------------------------------------------------------------------------
    - &OrdererOrg
        Name: OrdererOrg
        ID: OrdererMSP
        MSPDir: crypto-config/ordererOrganizations/orderer.tolling.network/msp

        # Policies define who can perform what actions
        Policies:
            Readers:
                Type: Signature
                Rule: "OR('OrdererMSP.member')"
            Writers:
                Type: Signature
                Rule: "OR('OrdererMSP.member')"
            Admins:
                Type: Signature
                Rule: "OR('OrdererMSP.admin')"

        # OrdererEndpoints for service discovery
        # NOTE: Using internal Docker ports (7050) for all orderers
        OrdererEndpoints:
            - orderer1.orderer.tolling.network:7050
            - orderer2.orderer.tolling.network:7050
            - orderer3.orderer.tolling.network:7050

    # ---------------------------------------------------------------------------
    # Peer Organizations
    # ---------------------------------------------------------------------------
    # Each organization represents a toll agency or consortium participant.
    # Anchor peers enable cross-org gossip communication.
    # ---------------------------------------------------------------------------

    # Org1 - Example: E-ZPass consortium member
    - &Org1
        Name: Org1MSP
        ID: Org1MSP
        MSPDir: crypto-config/peerOrganizations/org1.tolling.network/msp

        Policies:
            Readers:
                Type: Signature
                Rule: "OR('Org1MSP.admin', 'Org1MSP.peer', 'Org1MSP.client')"
            Writers:
                Type: Signature
                Rule: "OR('Org1MSP.admin', 'Org1MSP.client')"
            Admins:
                Type: Signature
                Rule: "OR('Org1MSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('Org1MSP.peer')"

        AnchorPeers:
            - Host: peer0.org1.tolling.network
              Port: 7051

    # Org2 - Example: CUSIOP consortium member
    - &Org2
        Name: Org2MSP
        ID: Org2MSP
        MSPDir: crypto-config/peerOrganizations/org2.tolling.network/msp

        Policies:
            Readers:
                Type: Signature
                Rule: "OR('Org2MSP.admin', 'Org2MSP.peer', 'Org2MSP.client')"
            Writers:
                Type: Signature
                Rule: "OR('Org2MSP.admin', 'Org2MSP.client')"
            Admins:
                Type: Signature
                Rule: "OR('Org2MSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('Org2MSP.peer')"

        AnchorPeers:
            - Host: peer0.org2.tolling.network
              Port: 8051

    # Org3 - Example: SEIOP consortium member
    - &Org3
        Name: Org3MSP
        ID: Org3MSP
        MSPDir: crypto-config/peerOrganizations/org3.tolling.network/msp

        Policies:
            Readers:
                Type: Signature
                Rule: "OR('Org3MSP.admin', 'Org3MSP.peer', 'Org3MSP.client')"
            Writers:
                Type: Signature
                Rule: "OR('Org3MSP.admin', 'Org3MSP.client')"
            Admins:
                Type: Signature
                Rule: "OR('Org3MSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('Org3MSP.peer')"

        AnchorPeers:
            - Host: peer0.org3.tolling.network
              Port: 9051

    # Org4 - Example: WRTO/FasTrak consortium member
    - &Org4
        Name: Org4MSP
        ID: Org4MSP
        MSPDir: crypto-config/peerOrganizations/org4.tolling.network/msp

        Policies:
            Readers:
                Type: Signature
                Rule: "OR('Org4MSP.admin', 'Org4MSP.peer', 'Org4MSP.client')"
            Writers:
                Type: Signature
                Rule: "OR('Org4MSP.admin', 'Org4MSP.client')"
            Admins:
                Type: Signature
                Rule: "OR('Org4MSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('Org4MSP.peer')"

        AnchorPeers:
            - Host: peer0.org4.tolling.network
              Port: 10051

################################################################################
#
#   Section: Capabilities
#
#   Capabilities define the features that must be supported by the network
#   components. Setting V2_5 requires all peers and orderers to be at least
#   Fabric 2.5.x.
#
################################################################################
Capabilities:
    Channel: &ChannelCapabilities
        V2_0: true

    Orderer: &OrdererCapabilities
        V2_0: true

    Application: &ApplicationCapabilities
        V2_5: true

################################################################################
#
#   Section: Application
#
#   Application configuration for peer organizations on channels.
#   Defines default policies for chaincode lifecycle, endorsement, etc.
#
################################################################################
Application: &ApplicationDefaults
    Organizations:

    Policies:
        Readers:
            Type: ImplicitMeta
            Rule: "ANY Readers"
        Writers:
            Type: ImplicitMeta
            Rule: "ANY Writers"
        Admins:
            Type: ImplicitMeta
            Rule: "MAJORITY Admins"
        LifecycleEndorsement:
            Type: ImplicitMeta
            Rule: "MAJORITY Endorsement"
        Endorsement:
            Type: ImplicitMeta
            Rule: "MAJORITY Endorsement"

    Capabilities:
        <<: *ApplicationCapabilities

################################################################################
#
#   Section: Orderer
#
#   Orderer configuration for the Raft consensus ordering service.
#   Raft provides crash fault tolerance with 3 nodes tolerating 1 failure.
#
################################################################################
Orderer: &OrdererDefaults
    # Raft ordering service (etcdraft)
    OrdererType: etcdraft

    # Raft consensus configuration
    # NOTE: Using internal Docker port (7050) for all orderers
    EtcdRaft:
        Consenters:
            - Host: orderer1.orderer.tolling.network
              Port: 7050
              ClientTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer1.orderer.tolling.network/tls/server.crt
              ServerTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer1.orderer.tolling.network/tls/server.crt
            - Host: orderer2.orderer.tolling.network
              Port: 7050
              ClientTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer2.orderer.tolling.network/tls/server.crt
              ServerTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer2.orderer.tolling.network/tls/server.crt
            - Host: orderer3.orderer.tolling.network
              Port: 7050
              ClientTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer3.orderer.tolling.network/tls/server.crt
              ServerTLSCert: crypto-config/ordererOrganizations/orderer.tolling.network/orderers/orderer3.orderer.tolling.network/tls/server.crt

        # Raft options - tuned for local development
        Options:
            TickInterval: 500ms
            ElectionTick: 10
            HeartbeatTick: 1
            MaxInflightBlocks: 5
            SnapshotIntervalSize: 16 MB

    # Batch configuration
    BatchTimeout: 2s
    BatchSize:
        MaxMessageCount: 10
        AbsoluteMaxBytes: 99 MB
        PreferredMaxBytes: 512 KB

    # Orderer addresses (for client connections within Docker network)
    Addresses:
        - orderer1.orderer.tolling.network:7050
        - orderer2.orderer.tolling.network:7050
        - orderer3.orderer.tolling.network:7050

    Organizations:

    Policies:
        Readers:
            Type: ImplicitMeta
            Rule: "ANY Readers"
        Writers:
            Type: ImplicitMeta
            Rule: "ANY Writers"
        Admins:
            Type: ImplicitMeta
            Rule: "MAJORITY Admins"
        BlockValidation:
            Type: ImplicitMeta
            Rule: "ANY Writers"

################################################################################
#
#   Section: Channel
#
#   Channel configuration defaults. Defines the default policies for channels.
#
################################################################################
Channel: &ChannelDefaults
    Policies:
        Readers:
            Type: ImplicitMeta
            Rule: "ANY Readers"
        Writers:
            Type: ImplicitMeta
            Rule: "ANY Writers"
        Admins:
            Type: ImplicitMeta
            Rule: "MAJORITY Admins"

    Capabilities:
        <<: *ChannelCapabilities

################################################################################
#
#   Section: Profiles
#
#   Configuration profiles for configtxgen tool.
#
################################################################################
Profiles:

    # ---------------------------------------------------------------------------
    # TollingGenesis - Genesis block for system channel
    # ---------------------------------------------------------------------------
    # Used to bootstrap the ordering service. Creates the system channel with
    # the orderer organization and defines the TollingConsortium.
    # ---------------------------------------------------------------------------
    TollingGenesis:
        <<: *ChannelDefaults
        Orderer:
            <<: *OrdererDefaults
            Organizations:
                - *OrdererOrg
            Capabilities:
                <<: *OrdererCapabilities
        Consortiums:
            TollingConsortium:
                Organizations:
                    - *Org1
                    - *Org2
                    - *Org3
                    - *Org4

    # ---------------------------------------------------------------------------
    # TollingChannel - Application channel for tolling transactions
    # ---------------------------------------------------------------------------
    # Main channel for toll interoperability. All four organizations participate.
    # Used to create channel transactions and anchor peer updates.
    # ---------------------------------------------------------------------------
    TollingChannel:
        Consortium: TollingConsortium
        <<: *ChannelDefaults
        Application:
            <<: *ApplicationDefaults
            Organizations:
                - *Org1
                - *Org2
                - *Org3
                - *Org4
            Capabilities:
                <<: *ApplicationCapabilities
